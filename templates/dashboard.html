<!DOCTYPE html>
<html>
<head>
    <title>SPINOFF Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
    <div class="summary-box">
        <strong>ì‹¤í—˜ ì§„ì…ë¥ :</strong>
        {{ ready_info.common | length + finished_users | length }}ëª… /
        {{
            ready_info.common | length
            + finished_users | length
            + ready_info.only_application | length
        }}ëª…
    </div>


    {% macro render_section(title, users, section_id) %}
    <div class="section">
        <h2>
            {{ title }} ({{ users | length }}ëª…)
            <button onclick="copyPhones('{{ section_id }}')">ì „í™”ë²ˆí˜¸ ë³µì‚¬</button>
            <button onclick="loadAndCopyText('{{ section_id }}')">ë¬¸ì ë‚´ìš© ë³µì‚¬</button>
        </h2>

        {% if users %}
        <div id="{{ section_id }}" style="display: none;">
            {{ users | map(attribute='phone') | join(', ') }}
        </div>
        <table>
            <tr><th>Name</th></tr>
            {% for person in users %}
            <tr><td>{{ person.name }}{% if person.pid %}-{{ person.pid }}{% endif %}</td></tr>
            {% endfor %}
        </table>
        {% else %}
        <p>í•´ë‹¹í•˜ëŠ” ì‹¤í—˜ìê°€ ì—†ìŠµë‹ˆë‹¤</p>
        {% endif %}
    </div>
    {% endmacro %}

    {{ render_section("ğŸš¨ Inactive Users", inactive_users, "inactivePhones") }}
    <!-- {{ render_section("ğŸ”š ì‹¤í—˜ ì¢…ë£Œì", finished_users, "finishedPhones") }} -->
        <div class="section">
        <h2>
            ğŸ”š ì‹¤í—˜ ì¢…ë£Œì ({{ finished_users | length }}ëª…)
            <button onclick="copyPhones('finishedPhones')">ì „í™”ë²ˆí˜¸ ë³µì‚¬</button>
            <button onclick="loadAndCopyText('finishedPhones')">ë¬¸ì ë‚´ìš© ë³µì‚¬</button>
        </h2>

        {# ë°œì†¡ ì•ˆ ëœ ë²ˆí˜¸ë§Œ ë³µì‚¬ ì˜ì—­ì— ë„£ìŒ #}
        {% set phones_to_copy = finished_users 
            | selectattr("phone") 
            | rejectattr("is_sent") 
            | map(attribute="phone") 
            | join(', ') 
        %}
        <div id="finishedPhones" style="display: none;">
            {{ phones_to_copy }}
        </div>

        <table>
            <tr><th>Name</th></tr>
            {% for person in finished_users %}
            <tr>
            <td class="{% if person.is_sent %}sent{% endif %}">
                {{ (person.name ~ "-" ~ person.pid).strip() if person.pid else person.name }}
                {% if person.is_sent %}(ë°œì†¡ ì™„ë£Œ){% endif %}
            </td>
            </tr>

            {% endfor %}
        </table>
    </div>
    {{ render_section("âœ… ì‹¤í—˜ ì§„í–‰ì", ready_info.common, "commonPhones") }}
    {{ render_section("ğŸ“‹ ì„¤ë¬¸ ì‘ë‹µë§Œ í•œ ì‚¬ëŒ", ready_info.only_survey, "surveyPhones") }}
    {{ render_section("ğŸ§ª í…ŒìŠ¤íŠ¸ë§Œ í•œ ì‚¬ëŒ", ready_info.only_test, "testPhones") }}
    {{ render_section("ğŸ“® ë©”ì¼ ë°œì†¡ ì™„ë£Œì ì¤‘ ë¯¸ì‘ë‹µì", ready_info.only_application, "appPhones") }}

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    </div>
</body>
</html>